(()=>{"use strict";var t,s={4438:(t,s,e)=>{var i=e(9477);const o=(t,s,e)=>Math.min(Math.max(t,s),e);var n=e(5079),r=e(4376),a=e(9365);class l{constructor(t,s,e){this.fixed=!1,this.position=t,this._mass=s,this.inverseMass=1/s,this.radius=e,this.springs={bend:[],shear:[],structure:[],all:[]},this.velocity=new i.Pa4}set mass(t){this._mass=t,this.inverseMass=1/t}get mass(){return this._mass}}class c{constructor(t,s,e){this.k=t,this.p0=s,this.p1=e,this.currentLength=s.position.distanceTo(e.position),this.relaxedLength=this.currentLength}updateF(){this.currentLength=this.p0.position.distanceTo(this.p1.position);const t=this.currentLength-this.relaxedLength;this.force=this.k*t}}class h extends i.Tme{constructor(t,s,e,i,o,n,r){super(),this.particles=[],this.structureSprings=[],this.bendSprings=[],this.shearSprings=[],this.forces=[],this.gravity=[0,-9.81,0],this.springConstants=o,this._mass=n,this.particleCount=(e+2)*(e+2),this.fixedParticles=r,this.setupParticles(t,s,e,i),this.setupSprings(o),this._activeParticles=this.particles.flat().filter((t=>!t.fixed)),this._springs=[...this.structureSprings,...this.shearSprings,...this.bendSprings],this._activeParticles.forEach((t=>t.springs.all=[...t.springs.structure,...t.springs.shear,...t.springs.bend]))}set mass(t){this._mass=t,this._activeParticles.forEach((t=>t.mass=this._mass/this.particleCount))}get springs(){return this._springs}setupParticles(t,s,e,o){var n;const r=t/(e+1),a=s/(e+1),c=this._mass/this.particleCount;for(let t=0;t<e+2;t++){this.particles.push([]);for(let s=0;s<e+2;s++){let e=new l(new i.Pa4(s*r,t*a,0),c,o/this.particleCount);(null===(n=this.fixedParticles)||void 0===n?void 0:n.some((e=>t==e[0]&&s==e[1])))&&(e.fixed=!0),this.particles[t].push(e)}}}setupSprings(t){if(0!==this.particles.length)for(let s=0;s<this.particles.length;s++)for(let e=0;e<this.particles[s].length;e++){const i=this.particles[s][e];try{const o=this.particles[s+1][e];if(o){let s=new c(t.structure,i,o);i.springs.structure.push(s),o.springs.structure.push(s),this.structureSprings.push(s)}}catch(t){}try{const o=this.particles[s+2][e];if(o){let s=new c(t.bend,i,o);i.springs.bend.push(s),o.springs.bend.push(s),this.bendSprings.push(s)}}catch(t){}try{const o=this.particles[s+1][e-1];if(o){let s=new c(t.shear,i,o);i.springs.shear.push(s),o.springs.shear.push(s),this.shearSprings.push(s)}}catch(t){}try{const o=this.particles[s][e+1];if(o){let s=new c(t.structure,i,o);i.springs.structure.push(s),o.springs.structure.push(s),this.structureSprings.push(s)}}catch(t){}try{const o=this.particles[s][e+2];if(o){let s=new c(t.bend,i,o);i.springs.bend.push(s),o.springs.bend.push(s),this.bendSprings.push(s)}}catch(t){}try{const o=this.particles[s+1][e+1];if(o){let s=new c(t.shear,i,o);i.springs.shear.push(s),o.springs.shear.push(s),this.shearSprings.push(s)}}catch(t){}}}f(t,s){const e=t[1],i=[0,0,0];return i[0]+=this.gravity[0],i[1]+=this.gravity[1],i[2]+=this.gravity[2],this.forces.forEach((t=>{const e=t.getForceVector(s);i[0]+=e[0]*s.inverseMass,i[1]+=e[1]*s.inverseMass,i[2]+=e[2]*s.inverseMass})),[e,i]}eulerStep(t){this.updateSpringForces();for(const s of this._activeParticles){const e=[[s.position.x,s.position.y,s.position.z],[s.velocity.x,s.velocity.y,s.velocity.z]],i=this.f(e,s);s.position.x+=i[0][0]*t,s.position.y+=i[0][1]*t,s.position.z+=i[0][2]*t,s.velocity.x+=i[1][0]*t,s.velocity.y+=i[1][1]*t,s.velocity.z+=i[1][2]*t}}updateSpringForces(){this._springs.forEach((t=>t.updateF()))}RK4Step(t){this.updateSpringForces();const s=t/2,e=t/3,i=t/6;for(const o of this._activeParticles){const n=[[o.position.x,o.position.y,o.position.z],[o.velocity.x,o.velocity.y,o.velocity.z]],r=this.f(n,o),a=[[n[0][0]+s*r[0][0],n[0][1]+s*r[0][1],n[0][2]+s*r[0][2]],[n[1][0]+s*r[1][0],n[1][1]+s*r[1][1],n[1][2]+s*r[1][2]]],l=this.f(a,o),c=[[n[0][0]+s*l[0][0],n[0][1]+s*l[0][1],n[0][2]+s*l[0][2]],[n[1][0]+s*l[1][0],n[1][1]+s*l[1][1],n[1][2]+s*l[1][2]]],h=this.f(c,o),p=[[n[0][0]+t*h[0][0],n[0][1]+t*h[0][1],n[0][2]+t*h[0][2]],[n[1][0]+t*h[1][0],n[1][1]+t*h[1][1],n[1][2]+t*h[1][2]]],d=this.f(p,o);o.position.x=n[0][0]+i*r[0][0]+e*l[0][0]+e*h[0][0]+i*d[0][0],o.position.y=n[0][1]+i*r[0][1]+e*l[0][1]+e*h[0][1]+i*d[0][1],o.position.z=n[0][2]+i*r[0][2]+e*l[0][2]+e*h[0][2]+i*d[0][2],o.velocity.x=n[1][0]+i*r[1][0]+e*l[1][0]+e*h[1][0]+i*d[1][0],o.velocity.y=n[1][1]+i*r[1][1]+e*l[1][1]+e*h[1][1]+i*d[1][1],o.velocity.z=n[1][2]+i*r[1][2]+e*l[1][2]+e*h[1][2]+i*d[1][2]}}}const p={green:new i.Ilk("#37ba42"),blue:new i.Ilk("#4237ba"),red:new i.Ilk("#ba4237"),white:new i.Ilk("#d8d8d8"),purple:new i.Ilk("#e18be3"),darkgrey:new i.Ilk("#242424"),lightgrey:new i.Ilk("#beabab")};var d=e(2327);const u={values:{showStats:!0,showInfo:!0,cloth:{mass:20,springOffset:0,showParticles:!0,showStructure:!1,showBend:!1,showShear:!1,pointLightColor:12233417,windForce:0,playSimulation:!1,viscosity:10,gravity:-9.81,springs:{structure:20,bend:10,shear:10},particleCount:0,springCount:0,subdivisions:0,stepSize:0,stepsPerFrame:20}},controllers:{}},g="Alt",v=document.querySelector(".nav-bar").clientHeight,w=document.querySelector("#infotext"),f=new i.CP7({canvas:document.querySelector("#glcanvas")});f.setSize(window.innerWidth,window.innerHeight-v),f.setPixelRatio(2);const m=f.getSize(new i.FM8),y=new i.xsS;y.add(new i.VLJ(16,16));const S=new i.cPb(60,m.x/m.y,.01,100);S.position.set(0,5,8);const b=(0,n.Z)();b.dom.style.top=`${v}px`,document.querySelector(".content-container").appendChild(b.dom),b.update();const C=new a.z(S,f.domElement);C.enabled=!1,w.innerHTML="Hold 'Alt' to move the camera.";const P=new r.XS({closeOnTop:!0,name:"Controls"}),x={general:P.addFolder("General Settings"),info:P.addFolder("Information"),simulation:P.addFolder("Simulation")};for(const t in x)x[t].open();P.domElement.style.marginTop=`${v}px`,x.general.add(u.values,"showStats").onChange((t=>{t?(b.begin(),b.dom.hidden=!1):(b.end(),b.dom.hidden=!0)})),x.general.add(u.values,"showInfo").onChange((t=>{w.hidden=!t})),u.controllers.playSimulation=x.simulation.add(u.values.cloth,"playSimulation"),x.simulation.add(u.values.cloth,"mass",5,100,1).onChange((t=>{_.mass=t})),x.simulation.add(u.values.cloth,"windForce",0,10,.1).onChange((t=>{D.intensity=t,$.setLength(o(Math.log(t),0,4),o(t/20,0,1),o(t/30,0,.67))})),x.simulation.add(u.values.cloth,"viscosity",0,20,.1).onChange((t=>{Y.viscosity=t})),x.simulation.add(u.values.cloth,"gravity",-15,15,.1).onChange((t=>{_.gravity[1]=t})),x.simulation.add(u.values.cloth.springs,"structure",0,100,1).onChange((t=>{_.structureSprings.forEach((s=>s.k=t))})),x.simulation.add(u.values.cloth.springs,"bend",0,100,1).onChange((t=>{_.bendSprings.forEach((s=>s.k=t))})),x.simulation.add(u.values.cloth.springs,"shear",0,100,1).onChange((t=>{_.shearSprings.forEach((s=>s.k=t))})),x.simulation.add(u.values.cloth,"stepsPerFrame",1,100,1),u.controllers.particleCount=x.info.add(u.values.cloth,"particleCount","").name("particles"),u.controllers.springCount=x.info.add(u.values.cloth,"springCount","").name("springs"),u.controllers.subdivisions=x.info.add(u.values.cloth,"subdivisions","").name("subdivisions"),u.controllers.stepSize=x.info.add(u.values.cloth,"stepSize").step(.001).name("StepSize in ms"),x.info.add(u.values.cloth,"showParticles").onChange((t=>{F.visible=t})),x.info.add(u.values.cloth,"showStructure").onChange((t=>{k.visible=t})),x.info.add(u.values.cloth,"showBend").onChange((t=>{z.visible=t})),x.info.add(u.values.cloth,"showShear").onChange((t=>{E.visible=t})),x.info.add(u.values.cloth,"springOffset",-.5,.5,.1).onChange((t=>{k.position.set(0,0,t),z.position.set(0,0,2*t),E.position.set(0,0,3*t)})),x.info.addColor(u.values.cloth,"pointLightColor").onChange((t=>{const s=new i.Ilk(t);q.color=s,J.color=s,T.material.color.set(s),H.material.color.set(s)})),window.addEventListener("resize",(()=>{((t,s)=>{const e=window.innerWidth,i=window.window.innerHeight-document.querySelector(".nav-bar").clientHeight;t.setSize(e,i),s.aspect=e/i,s.updateProjectionMatrix()})(f,S),f.render(y,S)}),!1),window.addEventListener("keydown",(t=>{t.key===g&&(C.enabled=!0)})),window.addEventListener("keyup",(t=>{t.key===g&&(C.enabled=!1)})),document.addEventListener("visibilitychange",(t=>{"hidden"==document.visibilityState&&u.controllers.playSimulation.setValue(!1)}));const _=new h(4,4,10,1,u.values.cloth.springs,u.values.cloth.mass,[[11,0],[11,11],[0,0],[0,11]]);u.controllers.particleCount.setValue(_.particles.flat().length.toString()),u.controllers.particleCount.domElement.children[0].setAttribute("disabled",!0),u.controllers.springCount.setValue(_.springs.length.toString()),u.controllers.springCount.domElement.children[0].setAttribute("disabled",!0),u.controllers.subdivisions.setValue(10..toString()),u.controllers.subdivisions.domElement.children[0].setAttribute("disabled",!0),u.controllers.stepSize.domElement.children[0].setAttribute("disabled",!0),y.add(_);const F=new i.ZAu,k=new i.ZAu;k.visible=u.values.cloth.showStructure;const z=new i.ZAu;z.visible=u.values.cloth.showBend;const E=new i.ZAu;E.visible=u.values.cloth.showShear,_.add(F),_.add(k),_.add(z),_.add(E);const L=new i.Aip(.05,8,8),A=new i.vBJ({color:4413044}),M=new i.nls({color:p.red}),O=new i.nls({color:p.green}),I=new i.nls({color:p.blue}),j=new i.Wid({color:p.white}),V=new i._12(1,1,11,11);V.setFromPoints(_.particles.flat().map((t=>t.position)));const B=new i.Kj0(V,j);B.castShadow=!0,B.receiveShadow=!0,j.side=i.ehD,_.add(B);const K=new i.Mig(4210752,.4);y.add(K);const T=new i.Kj0(new i.Aip(.2),new i.vBJ({color:u.values.cloth.pointLightColor}));T.position.set(2,2,5);const q=new i.cek(u.values.cloth.pointLightColor,1,100);T.add(q),y.add(T);const H=new i.Kj0(new i.Aip(.2),new i.vBJ({color:u.values.cloth.pointLightColor}));H.position.set(2,2,-5);const J=new i.cek(u.values.cloth.pointLightColor,1,100);H.add(J),y.add(H);for(const t of _.particles)for(const s of t){let t=new i.Kj0(L,A);t.position.copy(s.position.add(new i.Pa4(0,0,0))),F.add(t)}for(const t of _.structureSprings){const s=new i.x12(new i.u9r,M);s.geometry.setFromPoints([t.p0.position,t.p1.position]),k.add(s)}for(const t of _.bendSprings){const s=new i.x12(new i.u9r,O);s.geometry.setFromPoints([t.p0.position.add(new i.Pa4(0,0,0)),t.p1.position.add(new i.Pa4(0,0,0))]),z.add(s)}for(const t of _.shearSprings){const s=new i.x12(new i.u9r,I);s.geometry.setFromPoints([t.p0.position.add(new i.Pa4(0,0,0)),t.p1.position.add(new i.Pa4(0,0,0))]),E.add(s)}const Z=new i.Aip(.2),R=new i.vBJ({color:p.blue}),W=new i.Kj0(Z,R);W.position.set(-3,2,-3);const G=new d.Ys(S,f.domElement);G.attach(W),G.setSize(.5),y.add(G);const $=new i.tGC(new i.Pa4(0,0,1),new i.Pa4(0,0,0),0,p.blue,0,0);W.add($),W.lookAt(0,0,0),y.add(W);const D=new class{constructor(t,s,e){this._origin=t,this._target=s,this.intensity=e}get target(){return this._target}set origin(t){this._origin=t}getForceVector(t){const s=this._origin.distanceTo(this._target),e=this.intensity*(0,0+(this.intensity-0)*Math.random());return[(this._target.x-this._origin.x)/s*e,(this._target.y-this._origin.y)/s*e,(this._target.z-this._origin.z)/s*e]}}(W.position,new i.Pa4(0,2,0),u.values.cloth.windForce),X=new class{getForceVector(t){const s=[0,0,0];for(const e of t.springs.all){let i;i=e.p0===t?[e.p1.position.x-e.p0.position.x,e.p1.position.y-e.p0.position.y,e.p1.position.z-e.p0.position.z]:[e.p0.position.x-e.p1.position.x,e.p0.position.y-e.p1.position.y,e.p0.position.z-e.p1.position.z],s[0]+=i[0]*e.force,s[1]+=i[1]*e.force,s[2]+=i[2]*e.force}return s}},Y=new class{constructor(t){this.viscosity=t}getForceVector(t){const s=6*Math.PI*t.radius*this.viscosity;return[t.velocity.x*-s,t.velocity.y*-s,t.velocity.z*-s]}}(u.values.cloth.viscosity);_.forces.push(X),_.forces.push(D),_.forces.push(Y);let N=performance.now()/1e3;const Q=()=>{const t=performance.now()/1e3,s=(t-N)/u.values.cloth.stepsPerFrame;if(u.controllers.stepSize.setValue(1e3*s),D.origin=W.position,W.lookAt(D.target),u.values.cloth.playSimulation)for(let t=0;t<u.values.cloth.stepsPerFrame;t++)_.RK4Step(s);N=t,(()=>{if(u.values.cloth.showParticles)for(let t=0;t<_.particles.length;t++){const s=_.particles[t];for(let e=0;e<s.length;e++){const i=s[e];F.children[t*s.length+e].position.copy(i.position)}}if(u.values.cloth.showStructure)for(let t=0;t<_.structureSprings.length;t++){const s=_.structureSprings[t];k.children[t].geometry.setFromPoints([s.p0.position,s.p1.position])}if(u.values.cloth.showBend)for(let t=0;t<_.bendSprings.length;t++){const s=_.bendSprings[t];z.children[t].geometry.setFromPoints([s.p0.position,s.p1.position])}if(u.values.cloth.showShear)for(let t=0;t<_.shearSprings.length;t++){const s=_.shearSprings[t];E.children[t].geometry.setFromPoints([s.p0.position,s.p1.position])}V.setFromPoints(_.particles.flat().map((t=>t.position)))})(),f.render(y,S),b.update(),requestAnimationFrame(Q)};Q()}},e={};function i(t){var o=e[t];if(void 0!==o)return o.exports;var n=e[t]={exports:{}};return s[t](n,n.exports,i),n.exports}i.m=s,t=[],i.O=(s,e,o,n)=>{if(!e){var r=1/0;for(h=0;h<t.length;h++){for(var[e,o,n]=t[h],a=!0,l=0;l<e.length;l++)(!1&n||r>=n)&&Object.keys(i.O).every((t=>i.O[t](e[l])))?e.splice(l--,1):(a=!1,n<r&&(r=n));if(a){t.splice(h--,1);var c=o();void 0!==c&&(s=c)}}return s}n=n||0;for(var h=t.length;h>0&&t[h-1][2]>n;h--)t[h]=t[h-1];t[h]=[e,o,n]},i.d=(t,s)=>{for(var e in s)i.o(s,e)&&!i.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:s[e]})},i.o=(t,s)=>Object.prototype.hasOwnProperty.call(t,s),i.j=784,(()=>{var t={784:0};i.O.j=s=>0===t[s];var s=(s,e)=>{var o,n,[r,a,l]=e,c=0;if(r.some((s=>0!==t[s]))){for(o in a)i.o(a,o)&&(i.m[o]=a[o]);if(l)var h=l(i)}for(s&&s(e);c<r.length;c++)n=r[c],i.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return i.O(h)},e=self.webpackChunkcg3_ss22_indigo=self.webpackChunkcg3_ss22_indigo||[];e.forEach(s.bind(null,0)),e.push=s.bind(null,e.push.bind(e))})();var o=i.O(void 0,[736],(()=>i(4438)));o=i.O(o)})();